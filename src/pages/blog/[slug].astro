---
import BlogDetail from "../../components/pages/blog/BlogDetail.astro";
import { getPosts, getPostBySlug } from "../../lib/blog/api";

export async function getStaticPaths() {
  const posts = await getPosts("en");
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug as string, "en");

if (!post) {
  return Astro.redirect("/404");
}

// Find translated path
let translatedPath = "/es/blog";
if (post.related_post) {
  const esPosts = await getPosts("es");
  const esPost = esPosts.find((p) => p.id === post.related_post);
  if (esPost) {
    translatedPath = `/es/blog/${esPost.slug}`;
  }
}
---

<BlogDetail post={post} lang="en" translatedPath={translatedPath} />
