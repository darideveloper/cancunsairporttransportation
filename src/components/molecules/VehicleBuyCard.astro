---
// Libs
import { getLangFromUrl, useTranslations } from "../../lib/i18n/utils";
import {
  generateId,
  getFormattedPrice,
  getCurrencyCode,
} from "../../lib/utils";
import clsx from "clsx";

// Components
import ButtonCta from "../atoms/ButtonCta.astro";
import CheckListItem from "../atoms/CheckListItem.astro";
import StarRating from "../atoms/StarRating.astro";

// Icons
import { FaUserFriends, FaSuitcase } from "react-icons/fa";

// Types
interface Props {
  vehicleImage: string;
  vehicleName: string;
  maxPassengers: number;
  maxLuggage: number;
  price: number;
  originalPrice: number;
  rating: number; // 1 to 5
  description: string;
  items: string[];
}

const {
  vehicleImage,
  vehicleName,
  maxPassengers,
  maxLuggage,
  price,
  originalPrice,
  rating,
  description,
  items,
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Generate SEO-friendly alt and title for the image
const imageAlt = `${vehicleName} Private Transportation from Cancun Airport`;
const imageTitle = `${vehicleName} Private Transportation from Cancun Airport`;

// Generate unique ID for schema
const cardId = generateId("vehicle-card", vehicleName);

// Calculate savings
const savings = originalPrice - price;
const savingsPercentage =
  originalPrice > 0 ? Math.round((savings / originalPrice) * 100) : 0;
const hasSavings = savingsPercentage > 0;
---

<article
  class=""
  itemscope
  itemtype="https://schema.org/Product"
  aria-labelledby={cardId}
>
  <div class="">
    <!-- Vehicle Overview Section -->
    <div class="">
      <div class="">
        <img
          src={vehicleImage}
          alt={imageAlt}
          title={imageTitle}
          width="300"
          height="200"
          loading="lazy"
          class=""
        />
      </div>

      <div class="">
        <h3 class="" itemprop="name" id={cardId}>
          {vehicleName}
        </h3>

        <!-- Rating -->
        <div
          itemprop="aggregateRating"
          itemscope
          itemtype="https://schema.org/AggregateRating"
        >
          <StarRating rating={rating} withSchema={true} />
        </div>
      </div>

      <!-- Capacity Icons -->
      <div class="">
        <span class="" aria-label={`Maximum ${maxPassengers} passengers`}>
          <FaUserFriends className="" aria-hidden="true" />
          <span class="">
            {maxPassengers}
            {t("global.ui.vehicleCard.maxPassengers")}
          </span>
        </span>

        <span class="" aria-label={`Maximum ${maxLuggage} luggage`}>
          <FaSuitcase className="" aria-hidden="true" />
          <span class="">
            {maxLuggage}
            {t("global.ui.vehicleCard.maxLuggage")}
          </span>
        </span>
      </div>
    </div>

    <!-- Description and Features Section -->
    <div class="">
      <p class="" itemprop="description">
        {description}
      </p>

      <ul class="">
        {items.map((item) => <CheckListItem text={item} />)}
      </ul>
    </div>

    <!-- Pricing Section -->
    <div
      class=""
      itemprop="offers"
      itemscope
      itemtype="https://schema.org/Offer"
    >
      <meta itemprop="price" content={price.toString()} />
      <meta
        itemprop="priceCurrency"
        content={getCurrencyCode(lang).toUpperCase()}
      />
      <meta itemprop="availability" content="https://schema.org/InStock" />

      <div class="">
        <p class="">
          {t("global.ui.vehicleCard.priceFrom")}
        </p>

        <div class="">
          <p class="">
            <del class="">
              {getFormattedPrice(originalPrice, lang)}
            </del>
          </p>

          {
            hasSavings && (
              <div class="" role="status" aria-live="polite">
                <span class="">
                  {t("global.ui.vehicleCard.save")} {savingsPercentage}%
                </span>
              </div>
            )
          }
        </div>

        <p class="">
          {getFormattedPrice(price, lang)}
        </p>
        <p class="">
          {t("global.ui.vehicleCard.pricePerVehicle")}
        </p>
      </div>
    </div>

    <!-- Action Section -->
    <div class="">
      <ButtonCta href="#" class="">
        {t("global.ui.vehicleCard.bookNow")}
      </ButtonCta>
    </div>
  </div>
</article>
