---
// Libs
import { getLangFromUrl, useTranslations } from '../../lib/i18n/utils'

// Icons
import { TiThMenu as MenuIcon } from 'react-icons/ti'
import { IoClose as CloseIcon } from 'react-icons/io5'

// Components
import Logo from '../atoms/Logo.astro'
import ButtonCta from '../atoms/ButtonCta.astro'
import NavLinks from './NavLinks.astro'
import NavLink from '../atoms/NavLink.astro'

// Styles
import { MOBILE_MENU_STYLES as MOBILE_STYLES } from '../../styles/menu'

// Lang
const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)

// Constants & Data
const CTA_LINK = '/contact'
const CTA_LABEL = t('globalSections.menubar.cta')

const contactPhones = [
  { link: 'tel:+529983870435', label: '+52 (998) 387-0435' },
  { link: 'tel:+19299991258', label: '+1 (929) 999-1258' },
]

const translateLink = lang === 'es' ? '/en' : '/es'
---

<div
  id='menu-bar'
  class='flex justify-between items-center container max-w-[1750px]! mx-auto py-4 w-full'
>
  <!-- logo -->
  <Logo />

  <!-- navigation -->
  <nav
    aria-label={t('globalSections.menubar.nav.ariaLabel') || 'Main Navigation'}
  >
    <NavLinks
      lang={lang}
      mode='desktop'
    />
  </nav>

  <!-- cta -->
  <ButtonCta
    href={CTA_LINK}
    class='hidden lg:block'
  >
    {CTA_LABEL}
  </ButtonCta>

  <!-- mobile menu open button -->
  <button
    id='menu-open-button'
    aria-label='Open main menu'
    aria-expanded='false'
    aria-controls='menu-bar-mobile'
    class='text-yellow cursor-pointer text-3xl inline-block lg:hidden border-2 border-yellow p-3 rounded-xl'
  >
    <MenuIcon />
  </button>
</div>

<!-- mobile menu bar -->

<!-- menu top bar -->
<div
  class='fixed top-0 left-0 h-screen overflow-y-auto translate-x-full z-50 bg-white transition-transform duration-300 ease-in-out w-full'
  id='menu-bar-mobile'
  aria-hidden='true'
>
  <div class='px-4 flex justify-between w-full py-8'>
    <!-- Top "Menu" text -->
    <div class='menu-text flex items-center justify-center gap-4'>
      <MenuIcon className='text-2xl text-blue' />
      <p class='text-xl'>
        {t('globalSections.menubar.topSection.text')}
      </p>
    </div>

    <!-- Close button -->
    <button
      id='menu-close-button'
      aria-label='Close menu'
      aria-controls='menu-bar-mobile'
      class='text-blue cursor-pointer text-4xl inline-block lg:hidden border-2 border-blue p-2 rounded-xl'
    >
      <CloseIcon />
    </button>
  </div>

  <!-- Duplicate nav -->
  <nav aria-label='Mobile Navigation'>
    <NavLinks
      lang={lang}
      mode='mobile'
    >
      <!-- Mobile Extras -->
      <li class={MOBILE_STYLES.li}>
        <p><strong>{t('globalSections.menubar.translateWebsite')}</strong></p>
      </li>
      <li class={MOBILE_STYLES.li}>
        <NavLink
          link={translateLink}
          label={t('globalSections.menubar.translateWebsiteText')}
          class={MOBILE_STYLES.link}
        />
      </li>
      <li class={MOBILE_STYLES.li}>
        <p>
          <strong>{t('globalSections.menubar.customerService.title')}</strong>
        </p>
        <p class='mt-2'>{t('globalSections.menubar.customerService.body')}</p>
      </li>

      {
        contactPhones.map((phone) => (
          <li class={MOBILE_STYLES.li}>
            <NavLink
              link={phone.link}
              label={phone.label}
              class={MOBILE_STYLES.link}
            />
          </li>
        ))
      }
    </NavLinks>
  </nav>

  <!-- cta -->
  <ButtonCta
    href={CTA_LINK}
    class='mx-4 inline-block w-11/12 my-10 bg-yellow hover:bg-yellow-dark text-black! font-bold'
  >
    {CTA_LABEL}
  </ButtonCta>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const menuBarMobile = document.getElementById('menu-bar-mobile')
    const menuOpenButton = document.getElementById('menu-open-button')
    const menuCloseButton = document.getElementById('menu-close-button')

    const toggleMenu = (show: boolean) => {
      if (!menuBarMobile || !menuOpenButton) return

      if (show) {
        menuBarMobile.classList.remove('translate-x-full')
        menuBarMobile.setAttribute('aria-hidden', 'false')
        menuOpenButton.setAttribute('aria-expanded', 'true')
        // Focus trap logic could go here
      } else {
        menuBarMobile.classList.add('translate-x-full')
        menuBarMobile.setAttribute('aria-hidden', 'true')
        menuOpenButton.setAttribute('aria-expanded', 'false')
      }
    }

    if (menuOpenButton) {
      menuOpenButton.addEventListener('click', () => toggleMenu(true))
    }

    if (menuCloseButton) {
      menuCloseButton.addEventListener('click', () => toggleMenu(false))
    }
  })
</script>
