---
import { Image } from 'astro:assets'
import { FaStar } from 'react-icons/fa'
import ButtonCta from '../atoms/ButtonCta.astro'
import { clsx } from 'clsx'
import type { ImageMetadata } from 'astro'

interface Props {
  imageFile: ImageMetadata
  imageAlt: string
  imageTitle?: string
  title: string
  bestSeller?: boolean
  price: number | string
  ctaLink: string
  ctaText: string
  reverse?: boolean
  currency?: 'usd' | 'mxn'
}

const {
  imageFile,
  imageAlt,
  imageTitle,
  title,
  bestSeller = false,
  price,
  ctaLink,
  ctaText,
  reverse = false,
  currency = 'usd',
} = Astro.props

const formattedPrice = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: currency.toUpperCase(),
  minimumFractionDigits: 0,
}).format(typeof price === 'string' ? parseFloat(price) : price)
---

<article class='pricing-card'>
  {/* Best Seller Badge */}
  {
    bestSeller && (
      <div
        class='badge-best-seller'
        role='status'
        aria-label='Recommendation: Most Popular'
      >
        <span>MostPopular</span>
        <FaStar aria-hidden='true' />
      </div>
    )
  }

  <div>
    {/* Layout Order Logic */}
    {
      reverse ? (
        <>
          <h3>{title}</h3>
          <div>
            <Image
              src={imageFile}
              alt={imageAlt}
              title={imageTitle}
              loading='lazy'
            />
          </div>
        </>
      ) : (
        <>
          <div>
            <Image
              src={imageFile}
              alt={imageAlt}
              title={imageTitle}
              loading='lazy'
            />
          </div>
          <h3>{title}</h3>
        </>
      )
    }

    {/* Price Section */}
    <div
      class='price-section'
      aria-label={`Price starts from ${formattedPrice} ${currency}`}
    >
      <span aria-hidden='true'>Price from</span>
      <span
        class='price-value'
        aria-hidden='true'
        >{formattedPrice}</span
      >
      <span
        class='price-currency'
        aria-hidden='true'
        >{currency}</span
      >
    </div>

    {/* Dynamic Content */}
    <div class='content'>
      <slot />
    </div>

    {/* CTA Button */}
    <div class='cta-container'>
      <ButtonCta
        href={ctaLink}
        aria-label={`${ctaText} for ${title}`}
      >
        {ctaText}
      </ButtonCta>
    </div>
  </div>
</article>
