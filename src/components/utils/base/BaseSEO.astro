---
interface Props {
  currentPage: string; // Current page
  jsonType: string; // Type of the page
  extraJson?: Record<string, any>; // Extra JSON data
  baseDescription?: string; // Description of the page (optional, to ignore i18n)
  baseKeywords?: string; // Keywords of the page (optional, to ignore i18n)
  author?: string; // Author of the page (optional, to ignore i18n)
  useTagLine?: boolean; // Use tag line from i18n
}
const {
  currentPage,
  jsonType,
  extraJson = {},
  baseDescription = "",
  baseKeywords = "",
  author = "Dari Dev's Team",
  useTagLine = true,
} = Astro.props as Props;

// Libs
import { useTranslations, getLangFromUrl } from "../../../lib/i18n/utils";

const lang = getLangFromUrl(Astro.url);

// i18n
const t = useTranslations(lang);

// Data
const SITE_URL = import.meta.env.SITE_URL;
// import { email, socialNetworks } from '../../../data/contact'
// import { googleMapsLink } from '../../../data/contact'

// Get page metadata from i18n
const businessName =
  t("global.branding.businessName") || "Cancun Airport Transportation";
const pageName = t(`pages.${currentPage}.title`) || currentPage;
const description = t(`pages.${currentPage}.description`) || baseDescription;
const image = "/imgs/logo.webp";
const twitterHandle = "@DeveloperDari";
let keywords = t(`pages.${currentPage}.keywords`) || baseKeywords;

// Split keywords into an array if it's a string
const keywordsContent = Array.isArray(keywords)
  ? keywords.join(", ")
  : keywords;

// Calculate page title
let pageTitle;
if (currentPage == "home") {
  pageTitle = pageName;
} else if (useTagLine) {
  pageTitle = `${pageName} | ${businessName}`;
} else {
  pageTitle = pageName;
}

// Page slug â€” we assume `currentPage` is the slug, e.g., 'gallery'
const pageSlug = currentPage === "home" ? "" : `/${currentPage}`;

// Canonical URL for this language
const canonicalUrl = `${SITE_URL}/${lang}${pageSlug}`;

// Alternate URLs
const alternateUrls = {
  en: `${SITE_URL}/en${pageSlug}`,
  es: `${SITE_URL}/es${pageSlug}`,
};

// Generate data
const jsonLd = {
  "@context": "https://schema.org",
  "@type": jsonType || "LocalBusiness",
  "@id": `${SITE_URL}#localbusiness`,
  name: pageTitle,
  description: description,
  url: canonicalUrl,
  logo: `${SITE_URL}/imgs/logo.webp`,
  image: `${SITE_URL}/imgs/logo.webp`,
  // email: email,
  serviceArea: ["Yucatan", "Mexico"],
  // hasMap: googleMapsLink,
  // sameAs: [...socialNetworks.map((social) => social.link)],
  areaServed: [
    { "@type": "AdministrativeArea", name: "Yucatan" },
    { "@type": "Country", name: "Mexico" },
  ],
  inLanguage: lang || "en",
  ...extraJson,
};

const ogTypeMap = {
  LocalBusiness: "website",
  Blog: "blog",
  BlogPosting: "article",
};
const ogType = ogTypeMap[jsonType as keyof typeof ogTypeMap] || "website";
---

<!-- Html tags -->
<title>{pageTitle}</title>
<meta name="description" content={description} />
{keywordsContent && <meta name="keywords" content={keywordsContent} />}
<meta name="author" content={author} />

<!-- Open Graph tags -->
<meta property="og:type" content={ogType} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:image" content={image} />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content={twitterHandle} />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={image} />
<meta name="twitter:creator" content="@DeveloperDari" />

<!-- Json Ld -->
<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

<!-- Sitemap -->
<link rel="sitemap" href="/sitemap-index.xml" />

<!-- Lang -->
<link rel="canonical" href={canonicalUrl} />
<link rel="alternate" hreflang="en" href={alternateUrls.en} />
<link rel="alternate" hreflang="es" href={alternateUrls.es} />
