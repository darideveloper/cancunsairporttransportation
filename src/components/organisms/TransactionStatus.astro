---
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import clsx from 'clsx'
import {
  getLangFromUrl,
  getTranslations,
  getLocalizedPath,
} from '../../lib/i18n/utils'
import SectionHeading from '../molecules/SectionHeading.astro'
import ButtonCta from '../atoms/ButtonCta'
import { EMAIL, PHONES } from '../../data/site-config'

interface Props {
  title: string
  message: string
  image: ImageMetadata
  status: 'success' | 'error'
  reservationId?: string
}

const { title, message, image, status, reservationId } = Astro.props
const lang = getLangFromUrl(Astro.url)
const t = getTranslations(lang)

const isSuccess = status === 'success'

// Determine Routes
const homeRoute = getLocalizedPath('home', lang)
const reservationRoute = getLocalizedPath('reservation', lang)
const reservationLink = reservationId
  ? `${reservationRoute}?code=${reservationId}`
  : reservationRoute
---

<section class='container mx-auto px-4 py-12 md:py-24'>
  <div class='grid gap-12 lg:grid-cols-2 lg:items-center'>
    <!-- Content Side -->
    <div class='order-2 space-y-8 lg:order-1'>
      <SectionHeading
        title={title}
        isH1={true}
        class={clsx(
          'text-center lg:text-left',
          !isSuccess && '[&_h1]:text-red-700',
        )}
      >
        <p class='mx-auto max-w-lg text-lg text-gray-600 md:text-xl lg:mx-0'>
          {message}
        </p>
      </SectionHeading>

      <!-- Contact Info -->
      <div
        class='mt-8 space-y-4 border-t border-gray-200 pt-8 text-center text-gray-600 lg:text-left'
      >
        <p class='text-lg font-medium'>
          {
            isSuccess
              ? t('transaction.success.contact')
              : t('transaction.error.contact')
          }
        </p>
        <div class='flex flex-col items-center gap-2 text-base lg:items-start'>
          <a
            href={EMAIL.href}
            class='text-lg font-bold text-orange-500 transition-colors hover:text-orange-600'
          >
            {EMAIL.address}
          </a>

          <div
            class='flex flex-wrap items-baseline justify-center gap-x-2 lg:justify-start'
          >
            <span class='text-gray-500'>{t('transaction.call_us')}</span>
            <a
              href={PHONES.mexico.href}
              class='font-bold transition-colors hover:text-orange-500'
            >
              {PHONES.mexico.formatted}
            </a>
            <a
              href={PHONES.usa.href}
              class='font-bold transition-colors hover:text-orange-500'
            >
              {PHONES.usa.formatted}
            </a>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div
        class='flex flex-col justify-center gap-4 pt-4 sm:flex-row lg:justify-start'
      >
        <ButtonCta
          href={homeRoute}
          variant='blackGhost'
          className='min-w-[160px] font-bold'
        >
          {t('transaction.go_home')}
        </ButtonCta>
        <ButtonCta
          href={reservationLink}
          variant='orange'
          className='min-w-[200px] font-bold shadow-lg hover:shadow-xl'
        >
          {t('transaction.view_reservation')}
        </ButtonCta>
      </div>
    </div>

    <!-- Image Side -->
    <div class='relative order-1 flex justify-center lg:order-2 lg:justify-end'>
      <div class='relative w-full max-w-[600px]'>
        <Image
          src={image}
          alt={title}
          class='h-full w-full object-cover'
          width={800}
          height={600}
        />
      </div>
    </div>
  </div>
</section>
