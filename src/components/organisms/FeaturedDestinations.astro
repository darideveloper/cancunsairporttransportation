---
// Libs
import { useTranslations, getLangFromUrl } from "../../lib/i18n/utils";
import { getPriceValue, getCurrencyCode } from "../../lib/utils";
import { BASE_PRICES } from "../../data/prices";
import { marked } from "marked";

// Components
import SectionHeading from "../../components/molecules/SectionHeading.astro";
import PricingCard from "../../components/molecules/PricingCard.astro";
import ButtonCta from "../../components/atoms/ButtonCta.astro";
import { Image } from "astro:assets";

// Images
import tulumImg from "../../assets/images/destinations/tulum.webp";
import playaImg from "../../assets/images/destinations/playa-del-carmen.webp";
import cancunImg from "../../assets/images/destinations/cancun.webp";

// Props
interface Props {
  contentKey: string;
}

const { contentKey } = Astro.props;

// Get language
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const currency = getCurrencyCode(lang);

// Data with mapping to centralized pricing
const destinations = [
  {
    id: "tulum",
    image: tulumImg,
    priceKey: "tulum",
  },
  {
    id: "playa",
    image: playaImg,
    priceKey: "playaDelCarmen",
  },
  {
    id: "cancun",
    image: cancunImg,
    priceKey: "cancunZone",
  },
];
---

<section
  class="destinations-elements container mt-12"
  aria-labelledby="destinations-heading"
>
  <SectionHeading
    id="destinations-heading"
    class="top text-center"
    title={t(`pages.${contentKey}.destinations.title`)}
  >
    <p>{t(`pages.${contentKey}.destinations.text`)}</p>
  </SectionHeading>

  <ul
    class="middle mt-12 grid grid-cols-1 gap-8 md:grid-cols-3 md:gap-4 xl:gap-8"
  >
    {
      destinations.map((dest) => {
        // Get price from centralized pricing data
        const destinationPricing = BASE_PRICES[dest.priceKey]?.pricing;
        const usdPrice = destinationPricing?.private?.ow ?? null;
        const price = getPriceValue(usdPrice, lang);

        return (
          <li>
            <PricingCard
              title={t(
                `pages.${contentKey}.destinations.cards.${dest.id}.title`,
              )}
              price={price}
              ctaLink={t(
                `pages.${contentKey}.destinations.cards.${dest.id}.link`,
              )}
              ctaText={t(
                `pages.${contentKey}.destinations.cards.${dest.id}.ctaText`,
              )}
              currency={currency}
              bestSeller={false}
              reverse={true}
              class="hover:border-accent text-center transition-all duration-300 md:text-left"
            >
              <Image
                slot="image"
                src={dest.image}
                alt={t(
                  `pages.${contentKey}.destinations.cards.${dest.id}.title`,
                )}
                title={t(
                  `pages.${contentKey}.destinations.cards.${dest.id}.title`,
                )}
                widths={[300, 600, dest.image.width]}
                quality={60}
                format="avif"
                loading="lazy"
                decoding="async"
                class="mx-auto aspect-2/1 w-full rounded-t-lg object-cover md:aspect-12/11 lg:aspect-4/3"
              />
              <div
                slot="content"
                set:html={marked.parse(
                  t(
                    `pages.${contentKey}.destinations.cards.${dest.id}.description`,
                  ) || "",
                )}
                class="markdown text-justify text-sm"
              />
            </PricingCard>
          </li>
        );
      })
    }
  </ul>

  <div class="bottom mt-4 scale-90 text-center">
    <ButtonCta
      href={t(`pages.${contentKey}.destinations.viewMoreLink`)}
      variant="blueGhost"
      title={t(`pages.${contentKey}.destinations.viewMore`)}
      ariaLabel={t("global.accessibility.viewDetails", {
        item: t(`pages.${contentKey}.destinations.title`),
      })}
    >
      {t(`pages.${contentKey}.destinations.viewMore`)}
    </ButtonCta>
  </div>
</section>
