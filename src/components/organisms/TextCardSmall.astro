---
import { Image } from "astro:assets";
import { marked } from "marked";
import { getLangFromUrl, useTranslations } from "../../lib/i18n/utils";
import TextCard from "../molecules/TextCard.astro";

interface Props {
  page: string;
  section: string;
  image: ImageMetadata;
  id?: string;
  reverse?: boolean; // If true, image is on the right
  baseKey?: string; // Optional override for the full translation key path
  contentKey?: string; // Key for the text content (default: 'description')
  imageAltKey?: string; // Optional override key for alt text (default: 'title')
  imageClass?: string; // Optional class override for image
}

const {
  page,
  section,
  image,
  id,
  reverse,
  baseKey,
  contentKey,
  imageAltKey,
  imageClass,
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const translationBase = baseKey || `pages.${page}.${section}`;
const title = t(`${translationBase}.title`);
const imageAlt = imageAltKey ? t(`${translationBase}.${imageAltKey}`) : title;
const contentText = t(`${translationBase}.${contentKey || "description"}`);
const contentHtml = await marked.parse(contentText);
---

<TextCard
  id={id || section}
  title={title}
  class={`mt-12 flex flex-col items-center justify-center gap-8 ${reverse ? "md:flex-row-reverse" : "md:flex-row"}`}
>
  <Image
    slot="image"
    src={image}
    class={`h-full w-full rounded-xl object-cover md:w-1/2 lg:w-1/3 ${imageClass || ""}`}
    alt={imageAlt}
    widths={[400, 800, image.width]}
    sizes="(max-width: 768px) 400px, 800px"
    quality={60}
    format="avif"
    loading="lazy"
    decoding="async"
  />
  <div set:html={contentHtml} class="markdown text-justify" />
</TextCard>
