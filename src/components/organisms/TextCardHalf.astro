---
import { Image } from "astro:assets";
import { marked } from "marked";
import { getLangFromUrl, useTranslations } from "../../lib/i18n/utils";
import TextCard from "../molecules/TextCard.astro";

interface Props {
  contentKey: string; // Was page
  section: string;
  image: ImageMetadata;
  id?: string;
  reverse?: boolean; // If true, image is on the right
  baseKey?: string; // Optional override for the full translation key path
  fieldKey?: string; // Key for the text content (default: 'description')
  imageAltKey?: string; // Optional override key for alt text (default: 'title')
  imageClass?: string; // Optional class override for image
}

const {
  contentKey,
  section,
  image,
  id,
  reverse,
  baseKey,
  fieldKey,
  imageAltKey,
  imageClass,
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const translationBase = baseKey || `pages.${contentKey}.${section}`;
const title = t(`${translationBase}.title`);
const imageAlt = imageAltKey ? t(`${translationBase}.${imageAltKey}`) : title;
const contentText = t(`${translationBase}.${fieldKey || "description"}`);
const contentHtml = await marked.parse(contentText);
---

<TextCard
  id={id || section}
  title={title}
  class="mt-12 grid grid-cols-1 items-center justify-center gap-8 md:grid-cols-2"
>
  <Image
    slot="image"
    src={image}
    class={`h-full w-full rounded-xl object-cover ${imageClass || ""} ${reverse ? "md:order-last" : ""}`}
    alt={imageAlt}
    title={imageAlt}
    widths={[348, 696, 1220, image.width]}
    sizes="(max-width: 768px) 348px, (max-width: 1024px) 450px, 610px"
    quality={60}
    format="avif"
    loading="eager"
    decoding="async"
  />
  <div set:html={contentHtml} class="markdown" />
</TextCard>
