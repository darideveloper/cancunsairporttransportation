---
import { useTranslations, getLangFromUrl } from "../../lib/i18n/utils";
import SectionHeading from "../molecules/SectionHeading.astro";
import FaqItem from "../molecules/FaqItem.astro";

import { marked } from "marked";

interface Props {
  page: string; // e.g., "home", "playaDelCarmen"
}

const { page } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const title = t(`pages.${page}.faq.title`);
const localDescription = t(`pages.${page}.faq.description`);
const globalDescription = t("global.sections.faq.description");

// If the localized description is not found, it returns the key as string
const description =
  localDescription && localDescription !== `pages.${page}.faq.description`
    ? localDescription
    : globalDescription;

const faqItems = t(`pages.${page}.faq.items`) as any;
const faqKeys = Object.keys(faqItems);
---

<section
  class="container mt-12"
  id="faq-section"
  aria-labelledby="faq-section-heading"
>
  <SectionHeading
    id="faq-section-heading"
    title={title}
    class="mb-8 text-center"
  >
    <p>{description}</p>
  </SectionHeading>

  <div class="flex flex-col gap-4">
    {
      faqKeys.map((key) => (
        <FaqItem
          question={faqItems[key].question}
          answer={marked.parse(faqItems[key].answer) as string}
        />
      ))
    }
  </div>
</section>
