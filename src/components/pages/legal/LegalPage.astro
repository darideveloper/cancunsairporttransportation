---
import LegalLayout from "../../../layouts/LegalLayout.astro";
import { getCollection, render } from "astro:content";

interface Props {
  lang: "en" | "es";
  pageKey: string;
}

const { lang, pageKey } = Astro.props;

const PAGE_KEY_TO_SLUG: Record<string, string> = {
  privacy: "privacy-policy",
  terms: "terms-and-conditions",
};

const slug = PAGE_KEY_TO_SLUG[pageKey];

if (!slug) {
  throw new Error(`Unknown legal page key: ${pageKey}`);
}

const legalEntries = await getCollection("legal");
const entry = legalEntries.find((e) => {
  const cleanId = e.id.replace(/\.[^/.]+$/, "");
  return cleanId === `${lang}/${slug}`;
});

if (!entry) {
  throw new Error(
    `Legal content not found for key: ${pageKey} (${slug}) in language: ${lang}`,
  );
}

const { Content } = await render(entry);
---

<LegalLayout
  title={entry.data.title}
  description={entry.data.description}
  pageKey={pageKey}
>
  <Content />
</LegalLayout>
