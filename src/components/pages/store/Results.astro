---
// Libs
import { getLangFromUrl, useTranslations } from "../../../lib/i18n/utils";
import { marked } from "marked";

// Components
import Layout from "../../../layouts/Layout.astro";
import PageSEO from "../../utils/PageSEO.astro";
import RouteMap from "../../molecules/booking/RouteMap";
import NeedHelp from "../../organisms/NeedHelp.astro";
import WhyChooseUs from "../../organisms/WhyChooseUs.astro";
import H2 from "../../atoms/H2.astro";
import ButtonCta from "../../atoms/ButtonCta";
import VehicleBuyCard from "../../molecules/VehicleBuyCard";
import BookingForm from "../../organisms/BookingForm";
import { getFormattedPrice, getCurrencyCode } from "../../../lib/utils";
// Images

// Props
const { pageKey } = Astro.props;
const contentKey = pageKey || "results";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const currencyCode = getCurrencyCode(lang);
const vehicleLabels = {
  maxPassengers: t("global.ui.vehicleCard.maxPassengers"),
  maxLuggage: t("global.ui.vehicleCard.maxLuggage"),
  priceFrom: t("global.ui.vehicleCard.priceFrom"),
  save: t("global.ui.vehicleCard.save"),
  pricePerVehicle: t("global.ui.vehicleCard.pricePerVehicle"),
  bookNow: t("global.ui.vehicleCard.bookNow"),
};
---

<Layout pageKey={pageKey}>
  <PageSEO currentPage={contentKey} slot="seo" />
  <section
    class="container mx-auto flex flex-col-reverse items-start gap-8 px-4 py-12 md:flex-row-reverse"
  >
    <div class="flex w-full flex-col items-center justify-center">
      <header>
        <h1 class="font-title text-3xl font-bold text-gray-900">
          {t("pages.results.title")}
        </h1>
        <h2></h2>
        <p class="mt-4 text-gray-600">
          {t("pages.results.description")}
        </p>
      </header>

      <!-- Vehicle Buy Cards -->
      <div class="mt-8 w-full space-y-6">
        <VehicleBuyCard
          vehicleImage="https://placehold.co/300x200/png?text=Private+Van"
          vehicleName="Private Transportation"
          maxPassengers={8}
          maxLuggage={8}
          price={45.0}
          originalPrice={60.0}
          rating={5}
          description="Our private transportation service is perfect for families and small groups. Enjoy a comfortable and safe ride from Cancun Airport to your destination."
          items={[
            "Professional bilingual driver",
            "Flight monitoring included",
            "Travel insurance",
            "Air-conditioned vehicle",
            "Meet and greet at airport",
          ]}
          currencyCode={currencyCode}
          formattedPrice={getFormattedPrice(45.0, lang)}
          formattedOriginalPrice={getFormattedPrice(60.0, lang)}
          labels={vehicleLabels}
        />
      </div>
    </div>

    <!-- sidebar -->
    <div class="sidebar mx-auto w-full max-w-sm">
      <!-- Map -->
      <H2 class="[&_strong]:text-blue my-4">
        <Fragment
          set:html={marked.parseInline(t("pages.results.sidebar.route.title"))}
        />
      </H2>
      <RouteMap
        labels={{
          mapAriaLabel: t("pages.results.sidebar.route.mapAriaLabel"),
        }}
        client:load
      />

      <!-- Booking -->
      <ButtonCta id="modify-route-btn" type="button" className="mt-8 w-full">
        {t("pages.results.sidebar.route.modifyBtn")}
      </ButtonCta>
      <!-- Form -->
      <BookingForm
        translations={t("global.booking")}
        client:idle
        className="my-12 hidden! md:px-0!"
      />

      <!-- Why Choose Us -->
      <WhyChooseUs />

      <!-- Help -->
      <NeedHelp />
    </div>
  </section>
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const modifyBtn = document.getElementById("modify-route-btn");
    modifyBtn?.addEventListener("click", () => {
      const bookingForm = document.querySelector("#booking-form");
      bookingForm?.classList.toggle("hidden!");
    });
  });
</script>
