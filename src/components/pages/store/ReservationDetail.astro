---
// Layout
import Layout from '../../../layouts/Layout.astro'

// Libs
import { getTranslations } from '../../../lib/i18n/utils'
import { routes } from '../../../lib/i18n/routes'
import PageSEO from '../../../components/utils/PageSEO.astro'
import { FaCheckCircle, FaEnvelope } from 'react-icons/fa'

// Components
import ButtonCta from '../../../components/atoms/ButtonCta'
import BookingSummary from '../../../components/molecules/booking/BookingSummary'
import H2 from '../../../components/atoms/H2'

// Assets
import stripeImage from '../../../assets/images/checkout/stripe.png'

interface Props {
  lang: 'en' | 'es'
  pageKey: string
}

const { lang, pageKey } = Astro.props
const t = getTranslations(lang)

// Mock Data (To be replaced with real data fetching later)
const mockReservation = {
  code: '8V6LTSosO',
  service: 'Suburban',
  passengers: 1,
  from: 'Puerto Juarez',
  to: 'Akumal',
  pickupDate: '2026-03-03 12:00:00',
  vehicle: {
    id: 'suburban',
    name: 'Suburban',
    price: 1.0,
    maxPassengers: 6,
    maxLuggage: 4,
    image: '', // Needs a valid image URL or import if we challenge that
    type: 'private',
  },
  user: {
    name: 'Marcelo Rodriguez',
    phone: '+1756765867',
    email: 'jvso9414@gmail.com',
  },
}

// Prepare selectedVehicle object for BookingSummary
const selectedVehicle = {
  token: 'mock-token',
  name: mockReservation.vehicle.name,
  price: mockReservation.vehicle.price,
  maxPassengers: mockReservation.vehicle.maxPassengers,
  maxLuggage: mockReservation.vehicle.maxLuggage,
  image: mockReservation.vehicle.image,
  currency: 'USD',
  type: mockReservation.vehicle.type,
}
---

<Layout pageKey={pageKey}>
  <PageSEO
    currentPage='reservationDetail'
    slot='seo'
  />

  <section class='min-h-screen bg-gray-50 py-12'>
    <div class='container mx-auto max-w-6xl px-4'>
      {/* Header Section */}
      <div class='mb-12 text-center'>
        <h1 class='mb-8 text-4xl font-bold text-black capitalize'>
          {t('pages.reservationDetail.heading')}
        </h1>

        <div class='flex flex-col items-center gap-4'>
          <FaCheckCircle className='text-blue text-8xl' />

          <div class='flex flex-col items-center gap-4 md:flex-row'>
            <div
              class='mt-4 flex flex-col items-center gap-2 md:mr-4 md:items-end'
            >
              <div class='text-lg font-bold'>
                {
                  t('pages.reservationDetail.user.greeting', {
                    name: mockReservation.user.name,
                  })
                }
              </div>
              <div class='flex gap-2'>
                <div class='flex items-center gap-2'>
                  <span class='text-lg font-bold'>#</span>
                  {mockReservation.user.phone}
                </div>
                <div class='flex items-center gap-2'>
                  <FaEnvelope />
                  {mockReservation.user.email}
                </div>
              </div>
            </div>

            <div
              class='mt-4 flex flex-col items-center gap-4 border-l-0 border-gray-300 pl-0 md:flex-row md:border-l md:pl-8'
            >
              <div class='flex flex-col items-center gap-2 md:items-start'>
                <span class='text-sm font-bold text-black'
                  >{t('pages.reservationDetail.user.statusLabel')}</span
                >
                <span
                  class='border-blue text-blue w-fit rounded border px-2 py-1 text-center text-xs font-bold md:text-left'
                  >CONFIRMED</span
                >
              </div>
              <ButtonCta
                variant='red'
                href={`/${routes.reservation[lang]}`}
              >
                {t('pages.reservationDetail.user.logout')}
              </ButtonCta>
            </div>
          </div>
        </div>
      </div>

      <div
        class='bg-blue/10 mb-12 flex flex-col items-center justify-between gap-4 rounded-lg p-4 text-center md:flex-row md:text-left'
      >
        <p class='font-medium text-black'>
          {t('pages.reservationDetail.updatePayment.text')}
        </p>
        <ButtonCta
          href={Astro.url.pathname}
          variant='blue'
          className='w-full md:w-auto'
        >
          {t('pages.reservationDetail.updatePayment.button')}
        </ButtonCta>
      </div>

      <div class='grid grid-cols-1 gap-8 lg:grid-cols-7'>
        {/* Left Column: Details */}
        <div class='space-y-6 lg:col-span-4'>
          {/* Status Card */}
          <div
            class='border-accent rounded-r-lg border-l-4 bg-white p-6 shadow-sm'
          >
            <h3 class='mb-2 text-lg font-bold'>
              {t('pages.reservationDetail.user.statusLabel')}
            </h3>
            <span class='text-accent text-xl font-bold uppercase'
              >CONFIRMED</span
            >
          </div>

          {/* Details Table */}
          <div
            class='overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm'
          >
            <table class='w-full border-collapse text-left'>
              <tbody>
                <tr class='border-b border-gray-100'>
                  <th class='w-1/3 bg-gray-50 px-6 py-4 font-bold text-gray-700'
                    >{t('pages.reservationDetail.details.code')}</th
                  >
                  <td class='px-6 py-4 text-gray-900'>{mockReservation.code}</td
                  >
                </tr>
                <tr class='border-b border-gray-100'>
                  <th class='w-1/3 bg-gray-50 px-6 py-4 font-bold text-gray-700'
                    >{t('pages.reservationDetail.details.service')}</th
                  >
                  <td class='px-6 py-4 text-gray-900'
                    >{mockReservation.service}</td
                  >
                </tr>
                <tr class='border-b border-gray-100'>
                  <th class='w-1/3 bg-gray-50 px-6 py-4 font-bold text-gray-700'
                    >{t('pages.reservationDetail.details.passengers')}</th
                  >
                  <td class='px-6 py-4 text-gray-900'
                    >{mockReservation.passengers}</td
                  >
                </tr>
                <tr class='border-b border-gray-100'>
                  <th class='w-1/3 bg-gray-50 px-6 py-4 font-bold text-gray-700'
                    >{t('pages.reservationDetail.details.from')}</th
                  >
                  <td class='px-6 py-4 text-gray-900'>{mockReservation.from}</td
                  >
                </tr>
                <tr class='border-b border-gray-100'>
                  <th class='w-1/3 bg-gray-50 px-6 py-4 font-bold text-gray-700'
                    >{t('pages.reservationDetail.details.to')}</th
                  >
                  <td class='px-6 py-4 text-gray-900'>{mockReservation.to}</td>
                </tr>
                <tr>
                  <th class='w-1/3 bg-gray-50 px-6 py-4 font-bold text-gray-700'
                    >{t('pages.reservationDetail.details.pickup')}</th
                  >
                  <td class='px-6 py-4 text-gray-900'
                    >{mockReservation.pickupDate}</td
                  >
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        {/* Right Column: Payment Summary */}
        <div class='space-y-6 lg:col-span-3'>
          <H2 className='text-blue text-xl'
            >{t('pages.reservationDetail.payment.methods')}</H2
          >

          <BookingSummary
            lang={lang}
            selectedVehicle={selectedVehicle}
            currency='USD'
            passengers={mockReservation.passengers}
          />

          <div class='flex justify-center'>
            <img
              src={stripeImage.src}
              alt='Stripe'
              class='w-full object-contain'
            />
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>
